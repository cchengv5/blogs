<!DOCTYPE html>
<html>

<head>

    <title>概念地图</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src="graphic.js">
        // 更新按钮事件
        document.getElementById('updateBtn').onclick = updateGraph;
        document.getElementById('applyPhysicsBtn').onclick = applyPhysicsSettings;
    </script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <h1>概念地图</h1>
    <div id="container">
        <div id="input">
            <textarea id="textArea" placeholder="输入关系，每行一个"></textarea>
            <div class="button-container">
                <button onclick="updateGraph()">
                    <i class="material-icons" style="margin-right:8px">refresh</i>
                    更新图形
                </button>
                <button onclick="loadFromFile()">
                    <i class="material-icons" style="margin-right:8px">folder_open</i>
                    从文件加载
                </button>
                <button onclick="exportToSVG()">
                    <i class="material-icons" style="margin-right:8px">download</i>
                    导出SVG
                </button>
            </div>
        </div>
        <div class="splitter"></div>
        <div id="network"></div>
    </div>
</body>

</html>

<script>
    function loadFromFile() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.txt';
        input.onchange = e => {
            const file = e.target.files[0];
            currentFilePath = file.path; // 保存文件路径
            console.log("currentFilePath=", file.path);
            const reader = new FileReader();
            reader.onload = event => {
                document.getElementById('textArea').value = event.target.result;
                updateGraph();
            };
            reader.readAsText(file);
        };
        input.click();
    }

    document.addEventListener('DOMContentLoaded', function() {
        const container = document.getElementById('container');
        const input = document.getElementById('input');
        const network = document.getElementById('network');
        const splitter = document.querySelector('.splitter');

        // 从localStorage读取splitter位置
        const savedSplitterPosition = localStorage.getItem('splitterPosition');
        if(savedSplitterPosition) {
            const position = parseInt(savedSplitterPosition);
            input.style.width = position + 'px';
            network.style.width = (container.offsetWidth - position - 5) + 'px';
            splitter.style.left = position + 'px';
        }

        let isDragging = false;

        splitter.addEventListener('mousedown', function(e) {
            isDragging = true;
            document.body.style.cursor = 'col-resize';
            e.preventDefault();
        });

        document.addEventListener('mousemove', function(e) {
            if (!isDragging) return;
            
            const containerRect = container.getBoundingClientRect();
            const newInputWidth = e.clientX - containerRect.left;
            const containerWidth = containerRect.width;
            
            // 确保最小宽度
            const inputWidth = Math.max(100, Math.min(newInputWidth, containerWidth - 100));
            
            input.style.width = inputWidth + 'px';
            network.style.width = (containerWidth - inputWidth - 5) + 'px';
            splitter.style.left = inputWidth + 'px';
            
            // 保存splitter位置到localStorage
            localStorage.setItem('splitterPosition', inputWidth.toString());
        });

        document.addEventListener('mouseup', function() {
            isDragging = false;
            document.body.style.cursor = '';
        });
    });

    // 在DOM加载完成后添加加载保存内容的逻辑
    document.addEventListener('DOMContentLoaded', function () {
        const savedData = loadFromStorage();
        if (savedData) {
            document.getElementById('textArea').value = savedData;
        }

        // 添加输入监听器
        const textArea = document.getElementById('textArea');
        let debounceTimer;
        textArea.addEventListener('input', function () {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(updateGraph, 500); // 500ms防抖延迟
        });

        updateGraph();
    });
</script>

